<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PortalHub Creator - Selector Universal</title>
    <style>
        :root {
            --primary: #238636;
            --primary-dark: #196c2e;
            --secondary: #1f6feb;
            --danger: #f85149;
            --warning: #d29922;
            --success: #238636;
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --bg-input: #010409;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --border: #30363d;
            --radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(22, 27, 34, 0.8);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 2.8rem;
            background: linear-gradient(135deg, #58a6ff 0%, #238636 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 15px;
        }
        
        .app-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        
        @media (min-width: 992px) {
            .app-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }
        
        .panel-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            font-size: 1.4rem;
            color: var(--text-primary);
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary);
        }
        
        .panel-title i {
            color: var(--primary);
            font-size: 1.6rem;
        }
        
        /* Formularios */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(35, 134, 54, 0.2);
        }
        
        /* Selector Universal de Carpetas */
        .folder-selector {
            position: relative;
            margin: 30px 0;
        }
        
        .selector-box {
            border: 3px dashed var(--border);
            border-radius: var(--radius);
            padding: 60px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .selector-box:hover {
            border-color: var(--primary);
            background: rgba(35, 134, 54, 0.05);
            transform: translateY(-2px);
        }
        
        .selector-box.drag-over {
            border-color: var(--secondary);
            background: rgba(31, 111, 235, 0.1);
        }
        
        .selector-icon {
            font-size: 4rem;
            color: var(--secondary);
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .selector-text {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .selector-subtext {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 10px;
        }
        
        .folder-input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        /* Botones */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 32px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-upload {
            background: var(--secondary);
        }
        
        .btn-upload:hover:not(:disabled) {
            background: #185bcc;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover:not(:disabled) {
            background: #da3633;
        }
        
        /* Informaci√≥n de Carpeta */
        .folder-info {
            margin-top: 30px;
            padding: 25px;
            background: var(--bg-input);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            display: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background: rgba(22, 27, 34, 0.7);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* Lista de Archivos */
        .file-explorer {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 15px;
            background: var(--bg-input);
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid rgba(48, 54, 61, 0.5);
            transition: background 0.2s ease;
        }
        
        .file-item:hover {
            background: rgba(88, 166, 255, 0.05);
        }
        
        .file-icon {
            color: var(--secondary);
            font-size: 1.2rem;
            width: 30px;
            text-align: center;
        }
        
        .file-path {
            flex: 1;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            color: var(--text-primary);
        }
        
        .file-size {
            color: var(--text-secondary);
            font-size: 0.85rem;
            min-width: 80px;
            text-align: right;
        }
        
        /* Logs */
        .logs-panel {
            margin-top: 30px;
        }
        
        .logs-container {
            height: 400px;
            overflow-y: auto;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 15px;
        }
        
        .log-entry {
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: var(--radius);
            border-left: 4px solid transparent;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 0.9rem;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .log-info {
            background: rgba(56, 139, 253, 0.1);
            border-left-color: var(--secondary);
            color: #79c0ff;
        }
        
        .log-success {
            background: rgba(35, 134, 54, 0.1);
            border-left-color: var(--success);
            color: #56d364;
        }
        
        .log-warning {
            background: rgba(187, 128, 9, 0.1);
            border-left-color: var(--warning);
            color: #e3b341;
        }
        
        .log-error {
            background: rgba(248, 81, 73, 0.1);
            border-left-color: var(--danger);
            color: #ff7b72;
        }
        
        .log-time {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-right: 10px;
            display: inline-block;
            min-width: 70px;
        }
        
        /* Progress Bar */
        .progress-container {
            margin: 25px 0;
            display: none;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
        
        .progress-bar {
            height: 10px;
            background: var(--bg-input);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 5px;
            width: 0%;
            transition: width 0.4s ease;
        }
        
        /* Footer */
        footer {
            margin-top: 50px;
            text-align: center;
            padding: 30px;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
        }
        
        .compatibility-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid rgba(88, 166, 255, 0.3);
            border-radius: 20px;
            margin: 10px;
            font-size: 0.9rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .app-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .panel {
                padding: 20px;
            }
            
            .selector-box {
                padding: 40px 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=SF+Mono&display=swap">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-upload"></i> PortalHub Creator</h1>
            <p style="color: var(--text-secondary); font-size: 1.1rem; max-width: 800px; margin: 0 auto;">
                Sube carpetas COMPLETAS desde cualquier ubicaci√≥n de tu almacenamiento local directamente a GitHub. 
                Totalmente funcional en cualquier navegador moderno.
            </p>
        </header>
        
        <div class="app-grid">
            <!-- Panel de Configuraci√≥n -->
            <div class="panel">
                <h2 class="panel-title"><i class="fas fa-cogs"></i> Configuraci√≥n GitHub</h2>
                
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-key"></i> Personal Access Token</label>
                    <div style="position: relative;">
                        <input type="password" id="githubToken" class="form-control" 
                               placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" 
                               title="Token de GitHub con permisos 'repo'">
                        <button id="toggleToken" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); 
                                background: none; border: none; color: var(--text-secondary); cursor: pointer;">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                        <i class="fas fa-info-circle"></i> Necesitas un token con permisos <code>repo</code>
                        <a href="https://github.com/settings/tokens/new" target="_blank" 
                           style="color: var(--secondary); text-decoration: none; margin-left: 10px;">
                            <i class="fas fa-external-link-alt"></i> Generar token
                        </a>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-user"></i> Propietario del Repositorio</label>
                    <input type="text" id="repoOwner" class="form-control" placeholder="tu-usuario-o-organizacion">
                </div>
                
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-code-branch"></i> Nombre del Repositorio</label>
                    <input type="text" id="repoName" class="form-control" placeholder="mi-repositorio">
                </div>
                
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-comment"></i> Mensaje del Commit</label>
                    <input type="text" id="commitMessage" class="form-control" 
                           value="üöÄ Subida completa de portalHub">
                </div>
                
                <button class="btn" id="saveConfig">
                    <i class="fas fa-save"></i> Guardar Configuraci√≥n
                </button>
                
                <div class="folder-info" id="folderInfo">
                    <h3 style="margin-bottom: 20px; color: var(--text-primary);">
                        <i class="fas fa-folder-open"></i> Carpeta Seleccionada
                    </h3>
                    
                    <div class="stats-grid" id="fileStats">
                        <!-- Las estad√≠sticas se llenar√°n aqu√≠ -->
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: var(--text-secondary); font-weight: 600;">Estructura de archivos:</span>
                            <span style="color: var(--secondary); font-size: 0.9rem;" id="fileCountText"></span>
                        </div>
                        <div class="file-explorer" id="fileExplorer">
                            <!-- Los archivos se listar√°n aqu√≠ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Panel de Control -->
            <div class="panel">
                <h2 class="panel-title"><i class="fas fa-folder"></i> Seleccionar Carpeta</h2>
                
                <div class="folder-selector">
                    <div class="selector-box" id="selectorBox">
                        <i class="fas fa-cloud-upload-alt selector-icon"></i>
                        <div class="selector-text">Haz clic o arrastra una carpeta aqu√≠</div>
                        <div class="selector-subtext">Selecciona cualquier carpeta desde cualquier ubicaci√≥n de tu almacenamiento</div>
                        <div class="selector-subtext" style="color: var(--primary);">
                            <i class="fas fa-check-circle"></i> Compatible con todos los navegadores modernos
                        </div>
                        <input type="file" id="folderInput" class="folder-input" webkitdirectory multiple>
                    </div>
                </div>
                
                <div class="progress-container" id="progressContainer">
                    <div class="progress-header">
                        <span id="progressStatus">Preparando...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
                
                <button class="btn btn-upload" id="uploadBtn" disabled>
                    <i class="fas fa-cloud-upload-alt"></i> Subir a GitHub
                </button>
                
                <button class="btn btn-danger" id="cancelBtn" style="display: none;">
                    <i class="fas fa-stop-circle"></i> Cancelar Subida
                </button>
                
                <div class="logs-panel">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 class="panel-title" style="margin: 0; border: none; padding: 0;">
                            <i class="fas fa-terminal"></i> Logs de Proceso
                        </h3>
                        <div>
                            <button id="clearLogs" style="background: none; border: 1px solid var(--border); color: var(--text-secondary); 
                                    padding: 8px 15px; border-radius: var(--radius); cursor: pointer; margin-right: 10px;">
                                <i class="fas fa-trash"></i> Limpiar
                            </button>
                            <button id="exportLogs" style="background: none; border: 1px solid var(--border); color: var(--text-secondary); 
                                    padding: 8px 15px; border-radius: var(--radius); cursor: pointer;">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>
                    
                    <div class="logs-container" id="logsContainer">
                        <div class="log-entry log-info">
                            <span class="log-time" id="currentTime">00:00:00</span>
                            PortalHub Creator inicializado. Selecciona una carpeta para comenzar.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p style="margin-bottom: 20px; font-size: 1rem;">
                <i class="fas fa-shield-alt"></i> 100% seguro ¬∑ Tu token solo se env√≠a a GitHub API ¬∑ No se almacena en servidores externos
            </p>
            <div>
                <span class="compatibility-badge">
                    <i class="fab fa-chrome" style="color: #4285f4;"></i> Chrome
                </span>
                <span class="compatibility-badge">
                    <i class="fab fa-firefox" style="color: #ff7139;"></i> Firefox
                </span>
                <span class="compatibility-badge">
                    <i class="fab fa-edge" style="color: #0078d7;"></i> Edge
                </span>
                <span class="compatibility-badge">
                    <i class="fab fa-safari" style="color: #000000;"></i> Safari
                </span>
            </div>
            <p style="margin-top: 20px; color: var(--text-secondary); font-size: 0.9rem;">
                PortalHub Creator v2.0 ¬∑ Sube carpetas completas desde cualquier ubicaci√≥n de tu almacenamiento
            </p>
        </footer>
    </div>

    <script>
        // ===== CONFIGURACI√ìN =====
        const GITHUB_API = 'https://api.github.com';
        let files = [];
        let config = {
            token: '',
            owner: '',
            repo: '',
            commitMessage: 'üöÄ Subida completa de portalHub'
        };
        let isProcessing = false;
        let cancelRequested = false;
        
        // ===== ELEMENTOS DOM =====
        const elements = {
            githubToken: document.getElementById('githubToken'),
            repoOwner: document.getElementById('repoOwner'),
            repoName: document.getElementById('repoName'),
            commitMessage: document.getElementById('commitMessage'),
            saveConfig: document.getElementById('saveConfig'),
            folderInput: document.getElementById('folderInput'),
            selectorBox: document.getElementById('selectorBox'),
            uploadBtn: document.getElementById('uploadBtn'),
            cancelBtn: document.getElementById('cancelBtn'),
            folderInfo: document.getElementById('folderInfo'),
            fileStats: document.getElementById('fileStats'),
            fileExplorer: document.getElementById('fileExplorer'),
            fileCountText: document.getElementById('fileCountText'),
            logsContainer: document.getElementById('logsContainer'),
            progressContainer: document.getElementById('progressContainer'),
            progressFill: document.getElementById('progressFill'),
            progressStatus: document.getElementById('progressStatus'),
            progressPercent: document.getElementById('progressPercent'),
            clearLogs: document.getElementById('clearLogs'),
            exportLogs: document.getElementById('exportLogs'),
            toggleToken: document.getElementById('toggleToken'),
            currentTime: document.getElementById('currentTime')
        };
        
        // ===== LOGGING =====
        function updateTime() {
            const now = new Date();
            elements.currentTime.textContent = now.toLocaleTimeString('es-ES', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        function addLog(message, type = 'info') {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `
                <span class="log-time">${timeString}</span>
                ${message}
            `;
            
            elements.logsContainer.prepend(logEntry);
            updateTime();
            
            // Mantener m√°ximo 100 logs
            const logs = elements.logsContainer.querySelectorAll('.log-entry');
            if (logs.length > 100) {
                logs[logs.length - 1].remove();
            }
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // ===== CONFIGURACI√ìN =====
        function saveConfig() {
            config = {
                token: elements.githubToken.value.trim(),
                owner: elements.repoOwner.value.trim(),
                repo: elements.repoName.value.trim(),
                commitMessage: elements.commitMessage.value.trim() || 'üöÄ Subida completa de portalHub'
            };
            
            if (!config.token || !config.owner || !config.repo) {
                addLog('‚ùå Por favor completa todos los campos de configuraci√≥n', 'error');
                return;
            }
            
            if (!config.token.startsWith('ghp_') && !config.token.startsWith('github_pat_')) {
                addLog('‚ö†Ô∏è El token no parece tener el formato de GitHub PAT', 'warning');
            }
            
            localStorage.setItem('portalhub_config', JSON.stringify(config));
            addLog('‚úÖ Configuraci√≥n guardada correctamente', 'success');
            updateUI();
        }
        
        function loadConfig() {
            const saved = localStorage.getItem('portalhub_config');
            if (saved) {
                try {
                    config = JSON.parse(saved);
                    elements.githubToken.value = config.token;
                    elements.repoOwner.value = config.owner;
                    elements.repoName.value = config.repo;
                    elements.commitMessage.value = config.commitMessage;
                    addLog('‚öôÔ∏è Configuraci√≥n cargada desde almacenamiento local', 'info');
                } catch (e) {
                    console.error('Error loading config:', e);
                }
            }
        }
        
        // ===== SELECTOR DE CARPETAS =====
        function setupFolderSelector() {
            // Input de archivos con webkitdirectory
            elements.folderInput.addEventListener('change', handleFolderSelection);
            
            // Arrastrar y soltar
            elements.selectorBox.addEventListener('dragover', (e) => {
                e.preventDefault();
                elements.selectorBox.classList.add('drag-over');
            });
            
            elements.selectorBox.addEventListener('dragleave', () => {
                elements.selectorBox.classList.remove('drag-over');
            });
            
            elements.selectorBox.addEventListener('drop', (e) => {
                e.preventDefault();
                elements.selectorBox.classList.remove('drag-over');
                
                const items = e.dataTransfer.items;
                if (items.length > 0) {
                    processDroppedItems(items);
                }
            });
            
            // Click en el √°rea
            elements.selectorBox.addEventListener('click', () => {
                elements.folderInput.click();
            });
            
            addLog('üìÅ Selector de carpetas configurado', 'info');
        }
        
        function handleFolderSelection(event) {
            const fileList = event.target.files;
            processFileList(fileList);
        }
        
        async function processDroppedItems(items) {
            files = [];
            const entries = [];
            
            // Obtener todas las entradas
            for (const item of items) {
                if (item.kind === 'file') {
                    const entry = item.webkitGetAsEntry ? item.webkitGetAsEntry() : null;
                    if (entry) {
                        entries.push(entry);
                    }
                }
            }
            
            // Procesar recursivamente
            for (const entry of entries) {
                await scanEntry(entry);
            }
            
            updateFileDisplay();
        }
        
        function processFileList(fileList) {
            if (!fileList || fileList.length === 0) {
                addLog('‚ö†Ô∏è No se seleccionaron archivos', 'warning');
                return;
            }
            
            files = Array.from(fileList).map(file => ({
                path: file.webkitRelativePath || file.name,
                file: file,
                size: file.size,
                type: file.type
            }));
            
            updateFileDisplay();
        }
        
        async function scanEntry(entry, path = '') {
            return new Promise((resolve) => {
                if (entry.isFile) {
                    entry.file(file => {
                        files.push({
                            path: path ? `${path}/${file.name}` : file.name,
                            file: file,
                            size: file.size,
                            type: file.type
                        });
                        resolve();
                    });
                } else if (entry.isDirectory) {
                    const dirReader = entry.createReader();
                    dirReader.readEntries(async (entries) => {
                        for (const subEntry of entries) {
                            await scanEntry(subEntry, path ? `${path}/${entry.name}` : entry.name);
                        }
                        resolve();
                    });
                }
            });
        }
        
        function updateFileDisplay() {
            if (files.length === 0) {
                elements.folderInfo.style.display = 'none';
                return;
            }
            
            // Calcular estad√≠sticas
            const totalSize = files.reduce((sum, f) => sum + f.size, 0);
            const fileExtensions = new Set();
            files.forEach(f => {
                const ext = f.path.split('.').pop().toLowerCase();
                if (ext.length <= 6) fileExtensions.add(ext);
            });
            
            // Actualizar estad√≠sticas
            elements.fileStats.innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${files.length}</div>
                    <div class="stat-label">Archivos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${formatBytes(totalSize)}</div>
                    <div class="stat-label">Tama√±o Total</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${fileExtensions.size}</div>
                    <div class="stat-label">Extensiones</div>
                </div>
            `;
            
            // Mostrar lista de archivos (m√°ximo 50)
            let fileListHTML = '';
            const displayFiles = files.slice(0, 50);
            
            displayFiles.forEach((file, index) => {
                const icon = getFileIcon(file.path);
                fileListHTML += `
                    <div class="file-item">
                        <div class="file-icon">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div class="file-path" title="${file.path}">
                            ${file.path}
                        </div>
                        <div class="file-size">
                            ${formatBytes(file.size)}
                        </div>
                    </div>
                `;
            });
            
            if (files.length > 50) {
                fileListHTML += `
                    <div class="file-item" style="justify-content: center; color: var(--text-secondary); font-style: italic;">
                        ... y ${files.length - 50} archivos m√°s
                    </div>
                `;
            }
            
            elements.fileExplorer.innerHTML = fileListHTML;
            elements.fileCountText.textContent = `${files.length} archivos`;
            elements.folderInfo.style.display = 'block';
            
            addLog(`‚úÖ ${files.length} archivos cargados (${formatBytes(totalSize)})`, 'success');
            updateUI();
        }
        
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const iconMap = {
                'js': 'fa-js',
                'ts': 'fa-js',
                'jsx': 'fa-react',
                'tsx': 'fa-react',
                'html': 'fa-html5',
                'css': 'fa-css3',
                'scss': 'fa-sass',
                'json': 'fa-code',
                'md': 'fa-markdown',
                'txt': 'fa-file-alt',
                'py': 'fa-python',
                'java': 'fa-java',
                'cpp': 'fa-file-code',
                'c': 'fa-file-code',
                'php': 'fa-php',
                'rb': 'fa-gem',
                'go': 'fa-code',
                'rs': 'fa-cog',
                'swift': 'fa-apple',
                'kt': 'fa-code',
                'jpg': 'fa-file-image',
                'jpeg': 'fa-file-image',
                'png': 'fa-file-image',
                'gif': 'fa-file-image',
                'svg': 'fa-file-image',
                'ico': 'fa-file-image',
                'pdf': 'fa-file-pdf',
                'doc': 'fa-file-word',
                'docx': 'fa-file-word',
                'xls': 'fa-file-excel',
                'xlsx': 'fa-file-excel',
                'ppt': 'fa-file-powerpoint',
                'pptx': 'fa-file-powerpoint',
                'zip': 'fa-file-archive',
                'rar': 'fa-file-archive',
                '7z': 'fa-file-archive',
                'tar': 'fa-file-archive',
                'gz': 'fa-file-archive',
                'mp3': 'fa-file-audio',
                'wav': 'fa-file-audio',
                'mp4': 'fa-file-video',
                'avi': 'fa-file-video',
                'mov': 'fa-file-video',
                'exe': 'fa-cog',
                'dll': 'fa-cog',
                'sql': 'fa-database',
                'db': 'fa-database',
                'xml': 'fa-code',
                'yml': 'fa-code',
                'yaml': 'fa-code',
                'toml': 'fa-code',
                'ini': 'fa-cog',
                'cfg': 'fa-cog',
                'conf': 'fa-cog',
                'sh': 'fa-terminal',
                'bat': 'fa-terminal',
                'ps1': 'fa-terminal',
                'gitignore': 'fa-git',
                'dockerfile': 'fa-docker',
                'env': 'fa-cog'
            };
            
            return iconMap[ext] || 'fa-file';
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // ===== GITHUB API =====
        async function githubRequest(endpoint, options = {}) {
            if (cancelRequested) {
                throw new Error('Operaci√≥n cancelada por el usuario');
            }
            
            const url = `${GITHUB_API}${endpoint}`;
            const headers = {
                'Authorization': `token ${config.token}`,
                'Accept': 'application/vnd.github.v3+json',
                'User-Agent': 'PortalHub-Creator',
                ...options.headers
            };
            
            try {
                const response = await fetch(url, { ...options, headers });
                
                if (!response.ok) {
                    const error = await response.json().catch(() => ({}));
                    throw new Error(`GitHub API ${response.status}: ${error.message || response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                if (error.message !== 'Operaci√≥n cancelada por el usuario') {
                    addLog(`‚ùå Error en API: ${error.message}`, 'error');
                }
                throw error;
            }
        }
        
        async function uploadToGitHub() {
            if (isProcessing || files.length === 0) return;
            
            isProcessing = true;
            cancelRequested = false;
            updateUI();
            elements.progressContainer.style.display = 'block';
            
            try {
                // Validar
                if (!config.token || !config.owner || !config.repo) {
                    throw new Error('Configuraci√≥n incompleta');
                }
                
                // 1. Obtener √∫ltimo commit
                updateProgress(5, 'Conectando con GitHub...');
                let parentSha;
                try {
                    const ref = await githubRequest(`/repos/${config.owner}/${config.repo}/git/refs/heads/main`);
                    parentSha = ref.object.sha;
                    addLog('‚úÖ SHA del commit padre obtenido', 'success');
                } catch (error) {
                    try {
                        const ref = await githubRequest(`/repos/${config.owner}/${config.repo}/git/refs/heads/master`);
                        parentSha = ref.object.sha;
                        addLog('‚úÖ SHA del commit padre obtenido (rama master)', 'success');
                    } catch (e) {
                        throw new Error('Repositorio no encontrado. Verifica el nombre y propietario.');
                    }
                }
                
                // 2. Crear blobs (m√°ximo 100 archivos por seguridad)
                updateProgress(10, 'Preparando archivos...');
                const maxFiles = Math.min(files.length, 100);
                const tree = [];
                
                for (let i = 0; i < maxFiles; i++) {
                    if (cancelRequested) break;
                    
                    const file = files[i];
                    const progress = 10 + (i / maxFiles) * 70;
                    updateProgress(progress, `Procesando archivo ${i + 1}/${maxFiles}: ${file.path}`);
                    
                    try {
                        let content, encoding;
                        
                        if (file.type.startsWith('text/') || isTextFile(file.path)) {
                            content = await readFileAsText(file.file);
                            encoding = 'utf-8';
                        } else {
                            content = await readFileAsBase64(file.file);
                            encoding = 'base64';
                        }
                        
                        const blob = await githubRequest(`/repos/${config.owner}/${config.repo}/git/blobs`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ content, encoding })
                        });
                        
                        tree.push({
                            path: `portalHub/${file.path}`,
                            mode: '100644',
                            type: 'blob',
                            sha: blob.sha
                        });
                        
                        addLog(`‚úì ${file.path}`, 'info');
                        
                    } catch (error) {
                        addLog(`‚ö†Ô∏è Error con ${file.path}: ${error.message}`, 'warning');
                    }
                }
                
                if (cancelRequested) {
                    throw new Error('Operaci√≥n cancelada por el usuario');
                }
                
                if (tree.length === 0) {
                    throw new Error('No se pudo procesar ning√∫n archivo');
                }
                
                // 3. Crear tree
                updateProgress(85, 'Creando √°rbol de archivos...');
                const treeResponse = await githubRequest(`/repos/${config.owner}/${config.repo}/git/trees`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tree })
                });
                
                addLog(`‚úÖ √Årbol creado con ${tree.length} archivos`, 'success');
                
                // 4. Crear commit
                updateProgress(90, 'Creando commit...');
                const commit = await githubRequest(`/repos/${config.owner}/${config.repo}/git/commits`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: config.commitMessage,
                        tree: treeResponse.sha,
                        parents: [parentSha]
                    })
                });
                
                addLog('‚úÖ Commit creado', 'success');
                
                // 5. Actualizar referencia
                updateProgress(95, 'Actualizando rama...');
                try {
                    await githubRequest(`/repos/${config.owner}/${config.repo}/git/refs/heads/main`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sha: commit.sha })
                    });
                } catch (error) {
                    await githubRequest(`/repos/${config.owner}/${config.repo}/git/refs/heads/master`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sha: commit.sha })
                    });
                }
                
                updateProgress(100, '¬°Completado!');
                addLog('üéâ ¬°Estructura portalHub subida exitosamente a GitHub!', 'success');
                addLog(`üîó Visita: https://github.com/${config.owner}/${config.repo}/tree/main/portalHub`, 'info');
                
                // Ocultar progreso despu√©s de 3 segundos
                setTimeout(() => {
                    elements.progressContainer.style.display = 'none';
                }, 3000);
                
            } catch (error) {
                if (error.message === 'Operaci√≥n cancelada por el usuario') {
                    addLog('‚èπÔ∏è Operaci√≥n cancelada', 'warning');
                    updateProgress(0, 'Operaci√≥n cancelada');
                } else {
                    addLog(`‚ùå Error: ${error.message}`, 'error');
                    updateProgress(0, `Error: ${error.message}`);
                }
                
                setTimeout(() => {
                    elements.progressContainer.style.display = 'none';
                }, 3000);
                
            } finally {
                isProcessing = false;
                cancelRequested = false;
                updateUI();
            }
        }
        
        function isTextFile(filename) {
            const textExtensions = ['txt', 'md', 'js', 'ts', 'jsx', 'tsx', 'html', 'htm', 'css', 'scss', 'sass', 
                                   'json', 'xml', 'yml', 'yaml', 'toml', 'ini', 'cfg', 'conf', 'sh', 'bat', 'ps1', 
                                   'py', 'java', 'cpp', 'c', 'cs', 'php', 'rb', 'go', 'rs', 'swift', 'kt', 'sql',
                                   'gitignore', 'dockerfile', 'env'];
            const ext = filename.split('.').pop().toLowerCase();
            return textExtensions.includes(ext);
        }
        
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }
        
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function updateProgress(percent, status) {
            elements.progressFill.style.width = `${percent}%`;
            elements.progressStatus.textContent = status;
            elements.progressPercent.textContent = `${Math.round(percent)}%`;
        }
        
        // ===== UI CONTROLS =====
        function updateUI() {
            const hasConfig = config.token && config.owner && config.repo;
            const hasFiles = files.length > 0;
            
            elements.uploadBtn.disabled = !hasConfig || !hasFiles || isProcessing;
            
            if (isProcessing) {
                elements.uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Subiendo...';
                elements.cancelBtn.style.display = 'block';
            } else {
                elements.uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Subir a GitHub';
                elements.cancelBtn.style.display = 'none';
            }
        }
        
        function cancelUpload() {
            if (isProcessing) {
                cancelRequested = true;
                addLog('‚è∏Ô∏è Cancelando operaci√≥n...', 'warning');
            }
        }
        
        // ===== INICIALIZACI√ìN =====
        function init() {
            addLog('üöÄ PortalHub Creator inicializado', 'success');
            addLog('üìÅ Usa el selector para cargar carpetas desde cualquier ubicaci√≥n', 'info');
            
            // Cargar configuraci√≥n
            loadConfig();
            
            // Configurar eventos
            setupFolderSelector();
            
            elements.saveConfig.addEventListener('click', saveConfig);
            elements.uploadBtn.addEventListener('click', uploadToGitHub);
            elements.cancelBtn.addEventListener('click', cancelUpload);
            
            elements.toggleToken.addEventListener('click', () => {
                const type = elements.githubToken.type === 'password' ? 'text' : 'password';
                elements.githubToken.type = type;
                elements.toggleToken.innerHTML = type === 'password' 
                    ? '<i class="fas fa-eye"></i>' 
                    : '<i class="fas fa-eye-slash"></i>';
            });
            
            elements.clearLogs.addEventListener('click', () => {
                elements.logsContainer.innerHTML = '';
                addLog('üìã Logs limpiados', 'info');
            });
            
            elements.exportLogs.addEventListener('click', () => {
                const logs = Array.from(elements.logsContainer.querySelectorAll('.log-entry'))
                    .map(log => log.textContent)
                    .join('\n');
                
                const blob = new Blob([logs], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `portalhub-logs-${new Date().toISOString().slice(0, 10)}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
                addLog('üíæ Logs exportados', 'success');
            });
            
            // Auto-save
            ['githubToken', 'repoOwner', 'repoName', 'commitMessage'].forEach(id => {
                document.getElementById(id).addEventListener('change', saveConfig);
            });
            
            // Actualizar hora
            updateTime();
            setInterval(updateTime, 1000);
            
            updateUI();
        }
        
        // Iniciar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
